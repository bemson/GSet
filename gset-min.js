/*
 * GSet v1.0.0
 * http://github.com/bemson/GSet/
 *
 * Copyright 2010, Bemi Faison
 * Released under the MIT License
 */
(function(){var a={gvsCall:function(g,f,d,c,b){return(function e(){return g.apply(f,d)}).apply(c,b)},gsetCall:function(b,c){return function(){return b._gset.apply(b,[c].concat(arguments.length?[].slice.call(arguments):[]))}},customCall:function(e,c,d,b,g){var f=[b,d,"custom"];return function(){var h=arguments;if(!g(h,f)){return !1}return a.gvsCall(c[d],e,h,b,f)}},typeMap:{string:"s","[object Array]":"a","function":"f","[object Function]":"f"},rxp:{rtnFnc:/\breturn\b/,fsType:/[fs]/,afsType:/[afs]/},getType:function(c){var b=a.typeMap[typeof c]||a.typeMap[Object.prototype.toString.call(c)];return b&&(b!=="s"||b.length)?b:0},testValueTypes:function(f,b){var e=0,c=b.length,h,k=f.length,d,g=1;for(;e<c;e++){d=typeof b[e];g=0;for(h=0;h<k;h++){if(f[h]===d){g=1;break}}if(!g){break}}return g}};GSet=function(b,c){var f=this,k=arguments,i,g,o=a.rxp.rtnFnc,h=a.getType,m={},n=function(q,s){var r=s[1],p=!m[r];if(p&&h){m[r]=1;if(a.gvsCall(h,b,q,f,s)===!1){p=0}m[r]=0}return p},e,d,l,j;if(!(f.hasOwnProperty&&f instanceof GSet)){throw new Error("GSet: missing new operator")}if(b==null){throw new Error("GSet: invalid source")}if(k.length>2){if(k.length>3){h=[typeof k[2],typeof k[3],"function"];if((h[0]===h[2])===(h[1]===h[2])){throw new Error("GSet: too many or too few gate functions")}o=k[h[0]===h[2]?3:2];h=k[h[0]===h[2]?2:3]}else{if(typeof k[2]==="function"){h=k[2]}else{o=k[2]}}}if(c instanceof GSet){c=c._gset(a);i=c[0];g=c[1];if(o===a.rxp.rtnFnc){o=c[2]}if(h===a.getType){h=c[3]}c=c[4];for(l in g){if(g.hasOwnProperty(l)){m[l]=0;if(g[l]===2){f[l]=a.customCall(b,c,l,f,n)}else{f[l]=a.gsetCall(f,l)}}}}else{i={};g={};for(l in c){if(!c.hasOwnProperty(l)){continue}m[l]=0;e=c[l];d=a.getType(e);if(d==="f"){f[l]=a.customCall(b,c,l,f,n);g[l]=2}else{j={get:0,set:0};if(d!=="a"||(e.length===1&&(d=a.getType(e[0]))==="a")){if(d==="a"){c[l]=e[0];j.isAry=1}j.get=1;j.fixed=1;j.fixedValue=c[l]}else{if(!e.length){e=c[l]=[l,1]}d=[a.getType(e[0]),a.getType(e[1]),a.getType(e[2])];if((d[0]==="f"&&!a.rxp.rtnFnc.test(e[0]+""))||(d[1]==="f"&&!a.rxp.rtnFnc.test(e[1]+""))){continue}if(e[0]){j.get=1;j[d[0]==="f"?"getter":"getProperty"]=a.rxp.fsType.test(d[0])?e[0]:l}if(e[2]){j.set=1;j.validAny=1;if(a.rxp.fsType.test(d[2])){j[d[2]==="f"?"setter":"setProperty"]=e[2]}else{if(j.get){j[j.getter?"setter":"setProperty"]=j.getter||j.getProperty}}}else{if(e.length>2){j.set=0}}if(e[1]&&(e.length<3||j.set)){j.set=1;j.validAny=!a.rxp.afsType.test(d[1]);if(!j.validAny){j[d[1]==="f"?"validator":"types"]=d[1]==="s"?[e[1]]:e[1]}}}if(j.get||j.set){g[l]=j.get-j.set;i[l]=j;f[l]=a.gsetCall(f,l)}}}}if(h===a.getType){h=0}f._gset=function(t){var s=arguments,q=[].slice.call(arguments,1),u=q.length,v=u?"set":"get",w=[f,t,u?"vet":v],p=i.hasOwnProperty(t)&&i[t],r;if(!s.length){r=function(){};r.prototype=g;return new r()}if(t===o){return b}if(t===a){return[i,g,o,h,c]}if(p){if(p[v]){if(!n(q,w)){return !1}if(p.fixed){return p.isAry?p.fixedValue.concat():p.fixedValue}if(u){if(p.validAny||(p.validator&&a.gvsCall(p.validator,b,q,f,w))||(p.types&&a.testValueTypes(p.types,q))){if((p.setter||(!p.setProperty&&p.getter))&&w.splice(2,1,"set")){v=a.gvsCall(p.setter||p.getter,b,q,f,w);return(v===undefined)?!0:(u?!!v:v)}b[(v=p.setProperty||t)]=q[0];return b[v]===q[0]}}else{if(p.getter){return a.gvsCall(p.getter,b,q,f,w)}return b[p.getProperty||t]}}else{throw new Error('GSet: "'+t+'" has no '+v+"ter")}}else{throw new Error('GSet: "'+t+'" is unmapped')}return !1}};GSet.getContext=function(c){var b={gset:!1,alias:!1,action:!1},d=function(f,e){return typeof f===(e?"object":"function")};if(d(c,1)&&d((c=c.callee))&&d((c=c.caller))&&d((c=c.arguments),1)&&c.length===3){b.gset=c[0];b.alias=c[1];b.action=c[2]}return b}})()